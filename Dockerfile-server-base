# Dockerfile-server-base
# Image cơ sở chứa các phụ thuộc hệ thống và gói Python
FROM python:3.10-slim

# Cài đặt các phụ thuộc hệ thống
RUN apt-get update && \
    apt-get install -y --no-install-recommends libopus0 ffmpeg locales && \
    sed -i '/vi_VN.UTF-8/s/^# //g' /etc/locale.gen && \
    locale-gen && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Thiết lập biến môi trường để đảm bảo mã hóa ký tự đúng
ENV LANG=vi_VN.UTF-8 \
    LC_ALL=vi_VN.UTF-8 \
    LANGUAGE=vi_VN:vi \
    PYTHONIOENCODING=utf-8

WORKDIR /opt/xiaozhi-esp32-server

# Sao chép requirements.txt
COPY main/xiaozhi-server/requirements.txt .

# Cài đặt các gói Python phụ thuộc
RUN pip install --no-cache-dir --upgrade pip setuptools wheel && \
    pip install --no-cache-dir -r requirements.txt --default-timeout=120 --retries 5
